"use scrict";function getParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function removeParameterByName(n,t){var r;t||(t=window.location.href);var u=t.split("?")[0],f,i=[],e=t.indexOf("?")!==-1?t.split("?")[1]:"";if(e!==""){for(i=e.split("&"),r=i.length-1;r>=0;r-=1)f=i[r].split("=")[0],f===n&&i.splice(r,1);u=u+"?"+i.join("&")}return u}$(function(){if($('[data-toggle="popover"]').popover(),$('[data-toggle="tooltip"]').tooltip(),getParameterByName("nid")!==""&&getParameterByName("nid")!==null){let i=getParameterByName("nid"),t=getParameterByName("nt");window.history.replaceState(null,null,window.location.pathname);let n,r="$$$INVALID$$$";switch(i){case"1":n="Cliente criado com sucesso.";break;case"10":n="Cliente editado com sucesso.";break;case"11":n="O cliente não foi encontrado.";break;case"12":n="O cliente encontra-se inativo.";break;case"2":n="Password alterada com sucesso.";break;case"3":n="Ocorreu um erro ao alterar a password.";break;case"4":n="Espécie criada com sucesso.";break;case"40":n="Espécie editada com sucesso.";break;case"41":n="A espécie não foi encontrada.";break;case"42":n="A espécie encontra-se inativa";break;case"43":n="Já existe um espécie com o nome introduzido";break;case"5":n="Animal criado com sucesso.";break;case"50":n="Animal editado com sucesso.";break;case"51":n="O animal não foi encontrado.";break;default:n=r}switch(t){case"a":t="alert";break;case"s":t="success";break;case"w":t="warning";break;case"e":t="error";break;case"i":t="information";break;default:t="information"}n!==r?new Noty({text:n,type:t,layout:"topRight",timeout:2500,progressBar:!1}).show():console.error("ID noty não reconhecido ("&i&")")}$("#ClientesIndexTable .ClienteColumn").click(function(){if(!$(this).hasClass("disabled")){let n=$(this).attr("data-order"),i=$("#ClientesIndexSearch").val().trim(),t;t=n!=="asc"?"asc":"desc";$.ajax({url:"/Clientes/IndexTableData?field=nome&order="+t+"&query="+i,type:"get",beforeSend:function(){$("#ClientesIndexTable tbody").addClass("loading");$("#ClientesIndexTable .ClienteColumn").addClass("disabled")},success:function(t){$("#ClientesIndexTable tbody").html(t);n==="asc"?$("#ClientesIndexTable .ClienteColumn").attr("data-order","desc"):$("#ClientesIndexTable .ClienteColumn").attr("data-order","asc");$("#ClientesIndexTable tbody").removeClass("loading");$("#ClientesIndexTable .ClienteColumn").removeClass("disabled");$("#ClientesIndexTable .ClienteColumn i").hasClass("fa-caret-up")?($("#ClientesIndexTable .ClienteColumn i").removeClass("fa-caret-up"),$("#ClientesIndexTable .ClienteColumn i").addClass("fa-caret-down")):($("#ClientesIndexTable .ClienteColumn i").removeClass("fa-caret-down"),$("#ClientesIndexTable .ClienteColumn i").addClass("fa-caret-up"))}})}});let t,n=$("#PageTitle").html();typeof n!="undefined"&&(n=n.trim());$("#ClientesIndexSearch").on("input",function(){$("#ClientesIndexSearch").val().trim()!==""?$("#ClientesIndexSearchFormGroup .clear").fadeIn(100):$("#ClientesIndexSearchFormGroup .clear").fadeOut(100);i()});$("#ClientesIndexEstado").change(function(){i()});var i=function(){window.clearTimeout(t);t=window.setTimeout(function(){let t=$("#ClientesIndexSearch").val().trim(),i=$("#ClientesIndexTable .ClienteColumn").attr("data-order"),r=$("#ClientesIndexEstado").val();$.ajax({url:"/Clientes/IndexTableData",type:"get",data:{field:"nome",order:i,query:t,estado:r},beforeSend:function(){$("#ClientesIndexTable tbody").addClass("loading");$("#ClientesIndexTable .ClienteColumn").addClass("disabled")},success:function(n){$("#ClientesIndexTable tbody").html(n);$("#ClientesIndexTable tbody").removeClass("loading");$("#ClientesIndexTable .ClienteColumn").removeClass("disabled")}});t===""?$("#PageTitle").html(n):$("#PageTitle").html(n+' - Pesquisa por "<i>'+t+'<\/i>"')},400)};$(".hidden-text-link").hover(function(){$(this).find(".text").stop().fadeIn(200)},function(){$(this).find(".text").stop().fadeOut(200)});$("#ClientesIndexSearchFormGroup .clear").click(function(){$("#ClientesIndexSearch").val("").trigger("input");$(this).fadeOut(100)});$(".disable-user").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Desativar Cliente",text:"Está prestes a desativar este cliente. <br/>Um cliente inativo não pode ser alterado, não pode ser associado a eventos,não receberá notificações de eventos e quaisquer animais que lhe estejam associados estão igualmente inativos. É possivel reativar um cliente.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Desativar",confirmButtonColor:"#dd6777",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Clientes/DisableCliente",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Cliente desativado com sucesso.",type:"success"},function(){window.location.reload(!0)}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$(".enable-user").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Ativar Cliente",text:"Está prestes a ativar este cliente. <br/>Ao ser reativado, este cliente pode ser associado a eventos e receberá as suas notificações. <br/>Qualquer animal associado a este cliente que não tenha sido desativado individualmente será reativado.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Ativar",confirmButtonColor:"#6fc080",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Clientes/EnableCliente",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Cliente ativado com sucesso.",type:"success"},function(){window.location.reload(!0)}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$(".delete-especie").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Apagar Espécie",text:"Está prestes a apagar esta espécie. <br/>Ao apagar a espécie, não lhe poderá associar nenhum animal. <br/>Esta ação não pode ser revertida.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Apagar",confirmButtonColor:"#dd6777",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Especies/ApagarEspecie",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Espécie apagada com sucesso.",type:"success"},function(){window.location.href="/Especies"}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$.ajax({type:"get",url:"/XHR/Registos",data:{clientes:!0,animais:!0,especies:!1},error:function(){console.error("Ocorreu um erro ao enviar o pedido AJAX (/XHR/Registos)");$(".menu-loader").fadeOut("fast")},success:function(n){$(".menu-loader").fadeOut("fast",function(){n.clientes!==null&&$("#ClientesBadge").html(n.clientes).fadeIn(750);n.animais!==null&&$("#AnimaisBadge").html(n.animais).fadeIn(750);n.especies!==null&&$("#EspeciesBadge").html(n.especies).fadeIn(750);typeof n.error!="undefined"&&console.error(n.message)})}});$EspecieSelect=$("#EspeciesSelect").select2({placeholder:"Selecione uma espécie...",ajax:{language:"pt",delay:250,url:"/Especies/GetEspecies",dataType:"json",type:"GET",data:function(n){return{q:n.term,mr:10}},processResults:function(n){return{results:n}}},templateResult:function(n){return markup="<span class='title'>"+n.text+"<\/span> ",markup+="<span class='sub'>",typeof n.nrAnimais!="undefined"&&n.nrAnimais!==0&&(markup+=n.nrAnimais,markup+=n.nrAnimais===1?" Animal":" Animais"),markup+="<\/span>",$(markup)}});$("#GeneroSelect").select2({minimumResultsForSearch:-1,language:"pt",placeholder:"Selecione um género...",data:[{id:0,text:"Macho"},{id:1,text:"Fêmea"}]});$ClienteSelect=$("#ClienteSelect").select2({placeholder:"Selecione um cliente...",ajax:{language:"pt",delay:250,url:"/Clientes/GetClientes",dataType:"json",type:"GET",data:function(n){return{q:n.term,mr:15,page:n.page}},processResults:function(n,t){return t.page=t.page||1,{results:n.items,pagination:{more:t.page*15<n.total_items}}},cache:!0},templateResult:function(n){return markup="<span class='title'>"+n.text+"<\/span> ",typeof n.contacto!="undefined"&&(markup+="<span class='sub'>"+n.contacto+"<\/span>"),typeof n.morada!="undefined"&&typeof n.codPostal!="undefined"&&typeof n.localidade!="undefined"&&(markup+="<br />",markup+="<span class='morada'>"+n.morada+", "+n.codPostal+" "+n.localidade+"<\/span>"),$(markup)}});getParameterByName("cl")&&$ClienteSelect.val(getParameterByName("cl")).trigger("change")});