"use scrict";function getParameterByName(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function removeParameterByName(n,t){var r;t||(t=window.location.href);var u=t.split("?")[0],f,i=[],e=t.indexOf("?")!==-1?t.split("?")[1]:"";if(e!==""){for(i=e.split("&"),r=i.length-1;r>=0;r-=1)f=i[r].split("=")[0],f===n&&i.splice(r,1);u=u+"?"+i.join("&")}return u}function insertParameter(n,t){n=encodeURI(n);t=encodeURI(t);for(var i=document.location.search.substr(1).split("&"),r=i.length,u;r--;)if(u=i[r].split("="),u[0]===n){u[1]=t;i[r]=u.join("=");break}r<0&&(i[i.length]=[n,t].join("="));document.location.search=i.join("&")}function debounce(n,t,i){var r;return function(){var u=this,f=arguments,e=function(){r=null;i||n.apply(u,f)},o=i&&!r;clearTimeout(r);r=setTimeout(e,t);o&&n.apply(u,f)}}$(function(){function t(){var n=$(".search-input").val();n.length>0?($("#TopSearchDisplay").html(n),$.ajax({url:"/xhr/Search",method:"GET",data:{q:n},beforeSend:function(){$(".search-form .loader").removeClass("hidden");$(".search-predict").removeClass("hide")},success:function(n){$(".search-form .predictive-list").children().not(".loader").not(".no-data").remove();$(".search-form .predictive-list .no-data").addClass("hidden");var t,r;if(n.clientes.length>0)for($("#ClientesList .loader").addClass("hidden"),i=0;i<n.clientes.length;i++)t='<li class="p-a-0 lh-1">',t+='\t<a class="p-a-0" href="/Clientes/Detalhes/'+n.clientes[i].id+'">',t+="\t\t<span>"+n.clientes[i].nome+"<\/span> ",t+='\t\t<span class="text-muted">'+n.clientes[i].contacto+"<\/span>",t+="\t<\/a>",t+="<\/li>",$("#ClientesList").append(t);else $("#ClientesList .loader").addClass("hidden"),$("#ClientesList .no-data").removeClass("hidden");if(n.animais.length>0)for($("#AnimaisList .loader").addClass("hidden"),i=0;i<n.animais.length;i++)r=typeof n.animais[i].imagem=="string"&&n.animais[i].imagem.trim()!==""?"/upload/img/especies/"+n.animais[i].imagem:"/images/paw.jpg",t='<li class="p-a-0 lh-1">',t+='\t<a class="avatar p-a-0" href="/Animais/Detalhes/'+n.animais[i].id+'">',t+='\t\t<div class="search-top-img" style="background-image: url('+r+')"><\/div>',t+="\t\t<span>"+n.animais[i].nome+"<\/span> ",t+='\t\t<span class="text-muted">'+n.animais[i].cliente+"<\/span>",t+="\t<\/a>",t+="<\/li>",$("#AnimaisList").append(t);else $("#AnimaisList .loader").addClass("hidden"),$("#AnimaisList .no-data").removeClass("hidden")}})):$(".search-predict").addClass("hide")}if($('[data-toggle="popover"]').popover(),$('[data-toggle="tooltip"]').tooltip(),$(".datepicker, .input-daterange").datepicker({language:"pt"}),getParameterByName("nid")!==""&&getParameterByName("nid")!==null){let i=getParameterByName("nid"),t=getParameterByName("nt");window.history.replaceState(null,null,window.location.pathname);let n,r="$$$INVALID$$$";switch(i){case"1":n="Cliente criado com sucesso.";break;case"10":n="Cliente editado com sucesso.";break;case"11":n="O cliente não foi encontrado.";break;case"12":n="O cliente encontra-se inativo.";break;case"2":n="Password alterada com sucesso.";break;case"3":n="Ocorreu um erro ao alterar a password.";break;case"4":n="Espécie criada com sucesso.";break;case"40":n="Espécie editada com sucesso.";break;case"41":n="A espécie não foi encontrada.";break;case"42":n="A espécie encontra-se inativa";break;case"43":n="Já existe um espécie com o nome introduzido";break;case"5":n="Animal criado com sucesso.";break;case"50":n="Animal editado com sucesso.";break;case"51":n="O animal não foi encontrado.";break;case"6":n="Evento criado com sucesso.";break;case"60":n="Evento editado com sucesso.";break;case"61":n="O evento não foi encontrado.";break;default:n=r}switch(t){case"a":t="alert";break;case"s":t="success";break;case"w":t="warning";break;case"e":t="error";break;case"i":t="information";break;default:t="information"}n!==r?new Noty({text:n,type:t,layout:"topRight",timeout:2500,progressBar:!1}).show():console.error("ID noty não reconhecido ("&i&")")}let n=!1;$(".search-input").focus(debounce(function(){t()},750));$(".search-input").keyup(debounce(function(){t()},750));$(document).mouseup(function(n){var t=$(".search-predict");t.is(n.target)||t.has(n.target).length!==0||t.addClass("hide")});$("[data-toggle=search]").on("click",function(t){t.preventDefault();t.stopPropagation();n?($(".main-panel > .header").removeClass("search-open"),$(".search-form").addClass("hide"),$(".search-close-icon").addClass("hide"),$(".search-open-icon").removeClass("hide")):($(".main-panel > .header").addClass("search-open"),$(".search-form").removeClass("hide").find(".search-input")[0].focus(),$(".search-close-icon").removeClass("hide"),$(".search-open-icon").addClass("hide"));n=!n});$(".hidden-text-link").hover(function(){$(this).find(".text").stop().fadeIn(200)},function(){$(this).find(".text").stop().fadeOut(200)});$(".disable-user").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Desativar Cliente",text:"Está prestes a desativar este cliente. <br/>Um cliente inativo não pode ser alterado, não pode ser associado a eventos,não receberá notificações de eventos e quaisquer animais que lhe estejam associados estão igualmente inativos. É possivel reativar um cliente.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Desativar",confirmButtonColor:"#dd6777",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Clientes/DisableCliente",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Cliente desativado com sucesso.",type:"success"},function(){window.location.reload(!0)}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$(".enable-user").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Ativar Cliente",text:"Está prestes a ativar este cliente. <br/>Ao ser reativado, este cliente pode ser associado a eventos e receberá as suas notificações. <br/>Qualquer animal associado a este cliente que não tenha sido desativado individualmente será reativado.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Ativar",confirmButtonColor:"#6fc080",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Clientes/EnableCliente",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Cliente ativado com sucesso.",type:"success"},function(){window.location.reload(!0)}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$(".delete-user").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Apagar Cliente",text:"Está prestes a apagar este cliente. <br/>Ao ser apagado, todos os eventos e animais associados a este cliente serão também apagados. <br/>Esta ação é irreversível.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Apagar",confirmButtonColor:"#dd6777",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Clientes/DeleteCliente",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Cliente apagado com sucesso.",type:"success"},function(){window.location.href="/Clientes"}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$(".delete-especie").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Apagar Espécie",text:"Está prestes a apagar esta espécie. <br/>Ao apagar a espécie, não lhe poderá associar nenhum animal mas os animais existentes permanecerão. <br/>Esta ação não pode ser revertida.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Apagar",confirmButtonColor:"#dd6777",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Especies/ApagarEspecie",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Espécie apagada com sucesso.",type:"success"},function(){window.location.href="/Especies"}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$(".delete-animal").click(function(){let n=$(this).data("id");n!==null&&n!==""&&swal({title:"Apagar Animal",text:"Está prestes a apagar este animal. <br/>Ao apagar o animal, todos os eventos que lhe estão associados  serão desativados. <br />Esta ação não pode ser revertida.",type:"warning",html:!0,showCancelButton:!0,closeOnConfirm:!1,showLoaderOnConfirm:!0,confirmButtonText:"Apagar",confirmButtonColor:"#dd6777",cancelButtonText:"Cancelar",cancelButtonColor:"#e2e2e2"},function(){$.ajax({url:"/Animais/DeleteAnimal",type:"post",data:{Id:n},success:function(n){n===!0?swal({title:"Animal apagado com sucesso.",type:"success"},function(){window.location.href="/Animais"}):swal({title:"Ocorreu um erro. Se isto persistir, contacte a administração.",type:"error"})}})})});$.ajax({type:"get",url:"/XHR/Registos",data:{clientes:!0,animais:!0,especies:!1},error:function(){console.error("Ocorreu um erro ao enviar o pedido AJAX (/XHR/Registos)");$(".menu-loader").fadeOut("fast")},success:function(n){$(".menu-loader").fadeOut("fast",function(){n.clientes!==null&&$("#ClientesBadge").html(n.clientes).fadeIn(750);n.animais!==null&&$("#AnimaisBadge").html(n.animais).fadeIn(750);n.especies!==null&&$("#EspeciesBadge").html(n.especies).fadeIn(750);typeof n.error!="undefined"&&console.error(n.message)})}});$EspecieSelect=$("#EspeciesSelect").select2({placeholder:"Selecione uma espécie...",ajax:{language:"pt",delay:250,url:"/Especies/GetEspecies",dataType:"json",type:"GET",data:function(n){return{q:n.term,mr:10}},processResults:function(n){return{results:n}}},templateResult:function(n){return markup="<span class='title'>"+n.text+"<\/span> ",markup+="<span class='sub'>",typeof n.nrAnimais!="undefined"&&n.nrAnimais!==0&&(markup+=n.nrAnimais,markup+=n.nrAnimais===1?" Animal":" Animais"),markup+="<\/span>",$(markup)}});$("#GeneroSelect").select2({minimumResultsForSearch:-1,language:"pt",placeholder:"Selecione um género...",data:[{id:0,text:"Macho"},{id:1,text:"Fêmea"}]});$ClienteSelect=$("#ClienteSelect").select2({placeholder:"Selecione um cliente...",ajax:{language:"pt",delay:250,url:"/Clientes/GetClientes",dataType:"json",type:"GET",data:function(n){return{q:n.term,mr:15,page:n.page}},processResults:function(n,t){return t.page=t.page||1,{results:n.items,pagination:{more:t.page*15<n.total_items}}},cache:!0,initSelection:function(){}},templateResult:function(n){return markup="<span class='title'>"+n.text+"<\/span> ",typeof n.contacto!="undefined"&&(markup+="<span class='sub'>"+n.contacto+"<\/span>"),typeof n.morada!="undefined"&&typeof n.codPostal!="undefined"&&typeof n.localidade!="undefined"&&(markup+="<br />",markup+="<span class='morada'>"+n.morada+", "+n.codPostal+" "+n.localidade+"<\/span>"),$(markup)}});getParameterByName("cl")&&$ClienteSelect.val(getParameterByName("cl")).trigger("change");$("#EventosCriarForm #ClienteSelect").change(function(){$("#EventosCriarForm #AnimalSelect").val("").trigger("change")});$AnimalSelect=$("#AnimalSelect").select2({placeholder:"Selecione um animal...",ajax:{language:"pt",delay:250,url:"/Animais/GetAnimais",dataType:"json",type:"GET",data:function(n){return{q:n.term,cl:$("#ClienteSelect").val(),showWithoutCl:!1,mr:15,page:n.page}},processResults:function(n,t){return t.page=t.page||1,{results:n.items,pagination:{more:t.page*15<n.total_items}}},cache:!0,initSelection:function(){}},templateResult:function(n){return markup="",typeof n.espImg!="undefined"&&(markup+=n.espImg===null?"<div class='img-wrapper' style='background-image: url(/images/paw.jpg)'><\/div>":"<div class='img-wrapper' style='background-image: url(/upload/img/especies/"+n.espImg+")'><\/div>"),markup+="<div class='text'>",markup+="<span class='title'>"+n.text+"<\/span> ",typeof n.contacto!="undefined"&&(markup+="<span class='sub'>"+n.contacto+"<\/span>"),typeof n.espNome!="undefined"&&typeof n.genero!="undefined"&&(markup+="<br />",markup+="<span class='morada'>",n.genero===0?markup+="<i class='colored hidden-print icon-symbol-male'><\/i> ":n.genero===1&&(markup+="<i class='colored hidden-print icon-symbol-female'><\/i> "),markup+=n.genero===0||typeof n.espNomeF=="undefined"||n.espNomeF===null?n.espNome:n.espNomeF,markup+="<\/span>"),markup+="<\/div>",$(markup)}});$("#EventosCriarForm #Desc").on("keyup keydown change",function(){$("#EventosCriarForm #exemploDesc").html($(this).val())});$("#EventosCriarForm #ClienteSelect").on("change",function(){$("#EventosCriarForm #exemploCliente").html($("#EventosCriarForm #ClienteSelect option:selected").text().trim())});$("#EventosCriarForm #AnimalSelect").on("change",function(){let n=$("#AnimalSelect").select2("data");Object.keys(n).length!==0&&(n[0].genero===0?($("#EventosCriarForm #exemploGenero").html("do seu"),$("#EventosCriarForm #exemploEspecie").html(n[0].espNome.toLowerCase())):($("#EventosCriarForm #exemploGenero").html("da sua"),$("#EventosCriarForm #exemploEspecie").html(n[0].espNomeF.toLowerCase())),$("#EventosCriarForm #exemploAnimal").html(n[0].text))});$("#EventosCriarForm #Data").change(function(){let n=$(this).val().split("/"),t=new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])),i=new Date,r=Math.ceil((t-i)/864e5);$("#EventosCriarForm #exemploDias").html(r)});$("#EventosIndex .collapse").click(function(){$(this).parent().parent().hasClass("collapsed")?$(this).parent().parent().removeClass("collapsed"):$(this).parent().parent().addClass("collapsed")})});